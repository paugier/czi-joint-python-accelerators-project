# Workplan

The proposed project can be summarized in two main end-user focussed goals:

1. Improve the integration and usability of the existing accelerators to move
   obstacles in their usage out of the way.

2. Grow Transonic into a higher-level abstraction that covers up the differences
   between these systems, so that users can choose between them later rather
   than being tied to their initial technology decision.

From these goals, we extract the following work items:

Accelerator improvements:

1. Improve the pure-Python mode of Cython to reduce the need for non-Python syntax
   in user code (including the code generated by Transonic for its Cython backend).

2. Improve the coverage of Pythran for different NumPy and SciPy expressions to
   support a wider range of vectorised array operations.

3. Improve the integration of Pythran in Cython to support vectorised operations on
   a wider range of NumPy expressions inside of Cython modules.

4. Support Pythran compilation of NumPy operations on fast memory views in Cython
   to make Pythran support available in Cython's pure-Python mode.

5. Support dataclasses ([PEP-557](https://www.python.org/dev/peps/pep-0557/))
   efficiently in Pythran and Cython to provide users with a fast, typed data
   container.

6. Improve Numba's performance on higher-level code to support a broader set of
   Python language features efficiently.

7. Improve community engagement in the different projects by increasing the
   responsiveness to contributions and investing time into helping capable users
   to write their own pull requests.  For example, Cython has more than 700
   open issues and 77 pull requests, many of which are still worth investing
   the time to look into.

Transonic improvements:

1. Find the correct Transonic abstractions to represent most concepts available
   in the accelerators (`cast`, `nogil`, PyCapsules/cfunc/scipy.LowLevelCallable,
   parallel instructions, user-defined low-level types, fused types/multiple
   signatures, fastmath).  Design a good API for Transonic to express these
   concepts.

2. Feed the design decisions in Transonic back to the backends to improve their
   "Python feel-alike" user experience and reduce surprises on user side when
   targeting the different systems more directly.

3. Improve the code generation for Transonic's backends, i.e. write better/faster
   Cython/Numba/Pythran code from Transonic code.

4. Increase the robustness of Transonic to prevent its intermediate code generation
   from getting in the way of end-users.  This implies refactoring Transonic code
   and improving dependencies used for code analysis and transformation
   (Beniget and Gast).

5. Improve the test coverage and write a demo package using Transonic as
   scikit-image would use (with good documentation for developers and for users).

6. Other Transonic improvements:

   - Make it easy to write a new backend to Transonic.  Currently, it should
     already be possible to write a backend as a Transonic extension.  We will
     improve the documentation on this feature and contact developers of other
     accelerators (for example Weld and Pyccel) to collaborate on their Transonic
     backend.  We plan to propose an internship on this subject.

   - Find good solutions for how the Transonic backend is chosen by the user.

   - Transonic API to define alternative implementations of a function for
     different backends.

Evaluation:

1. Port scikit-image numerical kernels to Transonic to enable real-world comparisons
   between the existing Cython solutions and the different Transonic backends.
   These benchmarks should be reproducible on different platforms.

2. Make the comparison results available on a website.  We will propose to
   developers using other languages to submit their own implementations for
   comparison.

3. Demonstrate that Transonic-Cython is as fast as Cython on most scikit-image
   numerical kernels.

4. Create pull requests for the scikit-image and skimage-experiments repositories
   to use the accelerators via Transonic.  First, Cython to Transonic-Cython,
   then faster kernels (and/or cleaner code) with alternative backends (Pythran
   and Numba).

5. Beside these enhancements, we will also dedicate time and energy for community
   engagement, documentation and maintenance. Taking care of users and contributors
   is also an important task.

The deeper improvements of the accelerators will be performed by core
developers of these projects: Serge Guelton for Pythran, Stefan Behnel for
Cython and Valentin Haenel for Numba.  Stefan will also solve Cython issues that
are blockers for Transonic-Cython (see
<https://transonic.readthedocs.io/en/latest/backends/cython.html>). Serge will
be involved in the tasks on Transonic/Gast/Beniget refactoring and
Pythran/Cython integration.

A full-time developer hired for the project will work with Pierre Augier
(creator for Transonic) and in close collaboration with the other members of
the projects.  Her/his tasks will involve

- scikit-image and Transonic,

- the benchmarks and the associated website,

- reporting and investigating issues and solving the simpler ones,

- improving the documentation of the accelerators targeting users.
